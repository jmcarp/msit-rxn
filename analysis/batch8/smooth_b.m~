function smooth_b

global CCN;
clear matlabbatch;

% Estimation options
opts = spm_get_defaults('smooth');
if isfield(CCN.smooth, 'opts')
    opts = catstruct(opts, CCN.smooth.opts);
end

ffiles = expandpath(CCN.ffiles);

for fileidx = 1 : length(ffiles)
    
    vol = spm_vol(ffiles{fileidx});
    
    if strcmp(CCN.ext, 'nii')
        
        for imgidx = 1 : length(vol)
            spm_smooth(vol(imgidx), fileprep(vol(imgidx).fname, 's'), ...
                CCN.smooth.kernel);
        end
        
    elseif strcmp(CCN.ext, 'img')
        
        spm_smooth(vol, fileprep(vol.fname, 's'), ...
            CCN.smooth.kernel);
        
    end
    
end